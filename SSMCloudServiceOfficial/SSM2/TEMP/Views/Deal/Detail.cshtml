@using SSM.Models;

<script src="~/Scripts/Raphael.js"></script>
<script src="~/Scripts/progressStep.js"></script>
<style>
    div#progressBar {
        width: 100%;
        height: 100px;
    }

    body {
        background-color: white;
    }

    .float {
        position: fixed;
        width: 60px;
        height: 60px;
        bottom: 40px;
        right: 40px;
        background-color: #0C9;
        color: #FFF;
        border-radius: 50px;
        text-align: center;
        box-shadow: 2px 2px 3px #999;
    }

    .my-float {
        margin-top: 22px;
    }
</style>
<script>
    $(function () {
        $("#datepicker").datepicker();
    });
</script>
<style type="text/css">
    @@font-face {
        font-family: 'Roboto-Light';
        src: url("../../fonts/Roboto-Light.ttf") format('truetype');
    }

    @@font-face {
        font-family: 'Roboto-Black';
        src: url("../../fonts/Roboto-Black.ttf") format('truetype');
    }

    @@font-face {
        font-family: 'OpenSans-Bold';
        src: url('../../fonts/OpenSans-Bold.ttf') format('truetype');
    }

    .basic-grey {
        margin-left: auto;
        margin-right: auto;
        background: #F7F7F7;
        padding: 25px 15px 25px 10px;
        font: 12px Georgia, "Times New Roman", Times, serif;
        color: #888;
        text-shadow: 1px 1px 1px #FFF;
        border: 1px solid #E4E4E4;
    }

        .basic-grey h1 {
            font-size: 25px;
            padding: 0px 0px 10px 40px;
            display: block;
            border-bottom: 1px solid #E4E4E4;
            margin: -10px -15px 30px -10px;
            color: #888;
        }

            .basic-grey h1 > span {
                display: block;
                font-size: 11px;
            }

        .basic-grey label {
            display: block;
            margin: 0px;
        }

            .basic-grey label > span {
                float: left;
                width: 20%;
                text-align: right;
                padding-right: 10px;
                margin-top: 10px;
                color: #888;
            }

        .basic-grey input[type="text"], .basic-grey input[type="email"], .basic-grey textarea, .basic-grey select {
            border: 1px solid #DADADA;
            color: #888;
            height: 30px;
            margin-bottom: 16px;
            margin-right: 6px;
            margin-top: 2px;
            outline: 0 none;
            padding: 3px 3px 3px 5px;
            font-size: 12px;
            line-height: 15px;
            box-shadow: inset 0px 1px 4px #ECECEC;
            -moz-box-shadow: inset 0px 1px 4px #ECECEC;
            -webkit-box-shadow: inset 0px 1px 4px #ECECEC;
        }

        .basic-grey textarea {
            padding: 5px 3px 3px 5px;
        }

        .basic-grey select {
            background: #FFF url('down-arrow.png') no-repeat right;
            background: #FFF url('down-arrow.png') no-repeat right);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            text-indent: 0.01px;
            text-overflow: '';
            width: 70%;
            height: 35px;
            line-height: 25px;
        }

        .basic-grey textarea {
            height: 100px;
        }

        .basic-grey .button {
            background: #E27575;
            border: none;
            padding: 10px 25px 10px 25px;
            color: #FFF;
            box-shadow: 1px 1px 5px #B6B6B6;
            border-radius: 3px;
            text-shadow: 1px 1px 1px #9E3F3F;
            cursor: pointer;
        }

            .basic-grey .button:hover {
                background: #CF7A7A;
            }
</style>
<script>
    $(document).ready(function () {

        $("#timelinecontainer").on('scroll', function () {


            $(".cd-timeline-block").each(function () {

                if ($(this).offset().top <= $(window).scrollTop() + $(window).height() * 0.75 && $(this).find('.cd-timeline-img').hasClass('is-hidden')) {
                    $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
                }
            });
        });
    })

</script>
@if (ViewData["DealDetail"] != null)
{
    Deal thisDeal = (Deal)ViewData["DealDetail"];
    <div style="background:white;height:250px;" class="row">
        <div style="margin-top:20px" class="col-sm-8">
            <h1 style="font-size:30px;color:#595959">@thisDeal.Name</h1>
            <div>
                <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                <span>@thisDeal.contact.FirstName</span>
                <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                <span class="sr-only"></span>
            </div>

        </div>
        <form style="display:none" id="dealWonFinalize" action="/Deal/DealWon" method="post">

            <input type="hidden" name="id" value="@thisDeal.id" />
        </form>
        <form style="display:none" id="dealLostFinalize" action="/Deal/DealLost" method="post">

            <input type="hidden" name="id" value="@thisDeal.id" />
        </form>

        <div style="padding-top:40px" class="col-sm-2"><button onclick='wondeal()' type="button" class="btn btn-success" style="width:80%">Create order</button> </div>
        <div style="padding-top:40px" class="col-sm-2"><button type="button" class="btn btn-danger" style="width:80%">Lost</button></div>
        <script>
            function wondeal() {
                $("#dealWonFinalize").submit();
            }
        </script>

        <script>
            function onClick() {
                console.log("Clicked: " + this.index);
                return true;
            }

            function beforeEntry() {
                console.log("Before entry: " + this.index);
                return true;
            }

            function afterEntry() {
                console.log("After entry: " + this.index);
            }

            function beforeExit() {
                console.log("Before exit: " + this.index);
                return true;
            }

            function afterExit() {
                console.log("After exit: " + this.index);
            }

            $(document).ready(function () {
                var $progressDiv = $("#progressBar");
                var $progressBar = $progressDiv.progressStep();
                for (var step =0; step < @thisDeal.PrePurchase_FollowUp_Plan.Plan_Step.Count(); step++){
                    $progressBar.addStep("");
                }



                for (var stepCounter = 0; stepCounter  < @thisDeal.PrePurchase_FollowUp_Plan.Plan_Step.Count(); stepCounter++) {
                    var currentStep = $progressBar.getStep(stepCounter);
                    currentStep.onClick = onClick;
                    currentStep.beforeEntry = beforeEntry;
                    currentStep.afterEntry = afterEntry;
                    currentStep.beforeExit = beforeExit;
                    currentStep.afterExit = afterExit;
                }

                $progressBar.setCurrentStep(@(thisDeal.Stage-1));
                $progressBar.refreshLayout();
                var counter = 1;
                var intervalId = null;
                function startLoop() {
                    if (intervalId) {
                        // continue
                    }
                    else {
                        intervalId = setInterval(function () {
                            if (counter == 0) {
                                resetVisited();
                            }
                            $progressBar.setCurrentStep(counter);
                            counter++;
                            if (counter > 4) {
                                counter = 0;
                            }
                        }, 1000);
                    }
                }

                function stopLoop() {
                    if (intervalId) {
                        clearInterval(intervalId);
                        intervalId = null;
                    }
                }

                $("#startLoop").click(startLoop);
                $("#stopLoop").click(stopLoop);
                $("#resetVisited").click(resetVisited);
            });
        </script>
        <br />

        <br />
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <div id="progressBar"></div>

            </div>
        </div>

    </div>
    <div style="margin-top:10px" class="row">

        <!-- main col left -->
        <div class="col-sm-3">
            <div class="panel widget light-widget panel-bd-top">
                <div class="panel-body">
                    <div class="text-center vd_info-parent" style="width:100%;padding-top:0;margin-top:0">  <span style="font-family:OpenSans-Bold;font-size:50px;">DETAIL</span></div>
                    <br />
                    <div class="mgtp-20">
                        <table class="table table-striped table-hover">
                            <tbody>
                                <tr>
                                    <td style="width:60%;"><font color="black"> Start Date</font></td>
                                    <td><span>@thisDeal.StartDate.ToShortDateString()</span></td>
                                </tr>
                                <tr>
                                    <td><font color="black"> Total Value</font></td>
                                    <td>
                                       
                                        @if (thisDeal.Value != null)
                                        {
                                            <font id="valuetext" color="black">@(((double)thisDeal.Value).ToString("C"))</font>
                                            <input type="text" id="valuebox" value="@(((double)thisDeal.Value).ToString("C"))" style="display:none" />}
                                        else
                                        {
                                            <font id="valuetext" color="black">0</font>
                                            <input type="text" id="valuebox" value="0" style="display:none" />
                                        }
                                        
                                        <i class="fa fa-save" id="savebtn1" onclick="displayBox()" style="display:none"></i>
                                        <i class="fa fa-edit" onclick="hideBox()"></i>

                                    </td>
                                </tr>
                                <tr>
                                    <td><font color="black">Product Name</font></td>
                                    <td><font color="black">@thisDeal.softwareProduct.name</font></td>
                                </tr>
                                <tr>
                                    <td><font color="black">Aged</font></td>
                                    <td><font color="black">@((DateTime.Today - thisDeal.StartDate).TotalDays ) days</font> </td>
                                </tr>
                                <tr>
                                    <td><font color="black"> Last Updated </font></td>
                                    <td><font color="black">@thisDeal.LastUpdateStage</font> </td>
                                </tr>
                                <tr>
                                    <td><font color="black">  Status </font></td>
                                    <td><font class="label label-success" color="black">@thisDeal.DealStatu.Name</font> </td>
                                </tr>
                            </tbody>
                        </table>
                        <script>
                            function displayPlan() {
                                $("#Plan").toggle();
                                $("#savebtn2").toggle();
                            }
                            function hideBox() {
                                $("#valuebox").toggle();
                                $("#savebtn1").toggle();
                            }
                            function hidePlan() {
                                $("#Plan").toggle();
                                $("#savebtn2").toggle();
                            }
                            function displayBox() {
                                $("#valuebox").toggle();
                                $("#savebtn1").toggle();
                            }
                        </script>
                    </div>
                </div>
            </div>
            <div class="panel widget light-widget panel-bd-top">
                <div class="panel-body">
                    <div class="text-center vd_info-parent" style="width:100%;padding-top:0;margin-top:0">  <span style="font-family:OpenSans-Bold;font-size:50px;"> <button class="btn btn-primary" data-toggle="modal" data-target="#ItemModal" style="width:100%;height:100%">Deal items</button></span></div>
                    <br />

                </div>
            </div>
            <div class="panel widget light-widget panel-bd-top">
                <div class="panel-heading no-title"><span style="font-family:OpenSans-Bold;font-size:20px;">Customer</span> </div>
                <div class="panel-body">
                    <div class="text-center vd_info-parent"> <img alt="example image" src="@thisDeal.contact.Photo"> </div>
                    <br />
                    <div class="mgtp-20">
                        <table class="table table-striped table-hover">
                            <tbody>
                                <tr>
                                    <td><font color="black"> Full Name</font></td>
                                    <td><font color="black">@(thisDeal.contact.FirstName + " " + thisDeal.contact.MiddleName + " " + thisDeal.contact.LastName )</font></td>
                                </tr>
                                <tr>
                                    <td><font color="black">Email</font></td>
                                    <td><font color="black" id="CustomerEmail">@thisDeal.contact.emails</font> </td>
                                </tr>
                                <tr>
                                    <td><font color="black"> Phone</font></td>
                                    <td><font color="black">@thisDeal.contact.Phone</font> </td>
                                </tr>
                                <tr>
                                    <td><font color="black">  Birthday </font></td>
                                    <td><font color="black">@thisDeal.contact.DateOfBirth.ToShortDateString()</font> </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="panel widget light-widget panel-bd-top">
                <div class="panel-heading no-title"><span style="font-family:OpenSans-Bold;font-size:20px;">Company</span> </div>
                <div class="panel-body">
                    <div class="text-center vd_info-parent"> <img alt="example image" src="https://d13yacurqjgara.cloudfront.net/users/16411/screenshots/1069159/enterprise.png "> </div>
                    <br />
                    <div class="mgtp-20">
                        <table class="table table-striped table-hover">
                            <tbody>

                                <tr>
                                    <td><font color="black">Name</font></td>
                                    <td><font color="black"></font></td>
                                </tr>
                                <tr>
                                    <td><font color="black">Emails</font></td>
                                    <td><font color="black"></font> </td>
                                </tr>
                                <tr>
                                    <td><font color="black">Scale</font></td>
                                    <td><font color="black"></font> </td>
                                </tr>
                                <tr>
                                    <td><font color="black">Address</font></td>
                                    <td><font color="black"></font> </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>



        </div>

        <!-- main col right -->

        <div class="col-sm-9">



            @*<div class="pre-scrollable" id="timelinecontainer" style=";max-height: 800px; ">

                    <section id="cd-timeline" class="cd-container">
                        @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                        {
                            if (task.Deadline > DateTime.Today && task.TaskContent.Length == 0 )
                            {
                                <div class="cd-timeline-block">
                                    <div class="cd-timeline-img cd-location">
                                        <img src="~/Content/@(task.TaskType.Description.Trim()).png" alt="Picture" />

                                    </div> <!-- cd-timeline-img -->
                                    <div class="cd-timeline-content">
                                        <h2 style="font-size:25px">@task.TaskName</h2>
                                        <p style="font-size:15px">@task.TaskDescription</p>
                                        <a href="#0" class="cd-read-more">Finish It!</a>
                                        <span class="cd-date">@task.Deadline</span>
                                    </div> <!-- cd-timeline-content -->
                                </div> <!-- cd-timeline-block -->
                            }
                        }

                    </section> <!-- cd-timeline -->
                </div>*@
            <div style="margin-top:20px" class="tab" role="tabpanel">
                <!-- Nav tabs -->
                <ul style="list-style:none;  text-align:center;align-content:center" class="nav nav-tabs" role="tablist">
                    <li style="float:none;display:inline-block;" role="presentation" class="active"><a href="#normaltask" aria-controls="home" role="tab" data-toggle="tab"><p style="text-align: center;font-size:30px"><strong>Up-comming events</strong></p></a></li>
                    <li style="float:none;display:inline-block;" role="presentation"><a href="#emailconversation" aria-controls="profile" role="tab" data-toggle="tab"><p style="text-align: center;font-size:30px"><strong>Conversation</strong></p></a></li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="normaltask">
                        <div class="col-md-12 col-sm-6 col-xs-12">
                            <div class="x_panel">
                               
                                <div class="x_content">
                                    <ul class="list-unstyled timeline">
                                        @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                        {
                                            if (task.Deadline > DateTime.Today && task.TaskType.id != 7)
                                            {
                                                if (task.TaskType.id != 8)
                                                {
                                                    <li>
                                                        <div class="block">
                                                            <div class="tags">
                                                                <a href="" class="tag">
                                                                    <span>@task.TaskType.typeName</span>
                                                                </a>
                                                            </div>
                                                            <div class="block_content">
                                                                <h2 class="title">
                                                                    <a>@task.TaskName</a>
                                                                </h2>
                                                                <div class="byline">
                                                                    <span>Deadline in @( Math.Floor(((DateTime)task.Deadline - DateTime.Now).TotalHours)) hours at @task.Deadline </span>
                                                                </div>
                                                                <div class="excerpt">
                                                                    @task.TaskDescription
                                                                </div>
                                                                <div class="no-footer">
                                                                    <button class="btn btn-primary">Edit</button>
                                                                    <button class="btn btn-success">Complete</button>
                                                                    <button class="btn btn-danger">Cancel</button>
                                                                </div>
                                                            </div>
                                                  
                                                        </div>
                                                    </li>
                                                }
                                                else
                                                {
                                                    <li>
                                                        <div class="block">
                                                            <div class="tags">
                                                                <a href="" class="tag">
                                                                    <span>@task.TaskType.typeName</span>
                                                                </a>
                                                            </div>
                                                            <div class="block_content">
                                                                <h2 class="title">
                                                                    <a>@task.TaskName</a>
                                                                </h2>
                                                                <div class="byline">
                                                                    <span>Will be sent in @(((DateTime)task.Deadline - DateTime.Now).TotalHours) at @task.Deadline </span>
                                                                </div>
                                                                <div class="clearfix"></div>
                                                                <br />
                                                                <p class="excerpt">
                                                                    @Html.Raw(task.TaskDescription)
                                                                </p>
                                                                <br />
                                                                <div class="clearfix"></div>
                                                                <div class="no-footer">
                                                                    <button class="btn btn-primary">Edit</button>
                                                                    <button class="btn btn-success">Send Now</button>
                                                                    <button class="btn btn-danger">Cancel</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                }
                                            }
                                        }
                               

                                    </ul>

                                </div>
                            </div>
                        </div>
       
                    </div>

                    <div role="tabpanel" class="tab-pane fade pre-scrollable" style="height:800px;max-height:800px;margin-left:5px" id="emailconversation">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="x_panel">
                                    <div class="x_title">
                                        <h2>Deal's Emails </h2>
                                        <ul class="nav navbar-right panel_toolbox">
                                            <li>
                                                <a href="#"><i class="fa fa-chevron-up"></i></a>
                                            </li>
                                            <li class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>

                                            </li>
                                            <li>
                                                <a href="#"><i class="fa fa-close"></i></a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="x_content">

                                        <div class="row">
                                            <div class="col-sm-3 mail_list_column pre-scrollable">

                                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                                {
                                                    if (task.TaskType.id == 7 || task.TaskType.id == 8)
                                                    {
                                                        <div class="mail_list" onclick="tranferData(@task.id)" id="@task.id">
                                                            <div class="left">
                                                                <i class="fa fa-circle"></i>
                                                            </div>
                                                            <div class="right">
                                                                @if (task.TaskType.id == 7)
                                                                {
                                                                    <h3 name="sender"> @thisDeal.contact.emails <small name="crreatedDay">@task.CreateDate.ToShortDateString()</small></h3>

                                                                }
                                                                else
                                                                {
                                                                    <h3 name="sender"> You <small name="crreatedDay">@task.CreateDate.ToShortDateString()</small></h3>

                                                                }
                                                                <p name="mailtitle">@task.TaskName</p>
                                                                <input type="hidden" value="@task.TaskDescription" />
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                <script>
                                                    function tranferData(divID) {
                                                        document.getElementById("MailContent").innerHTML= $("#" + divID).find("input").val();
                                                        $("#emailDate").text($("#" + divID).find("small").text());
                                                        $("#emailtitle").text($("#" + divID).find("p").text());
                                                        $("#customerEmail").text($("#" + divID).find("h3").text());
                                                    }
                                                </script>


                                            </div>
                                            <!-- /MAIL LIST -->
                                            <!-- CONTENT MAIL -->
                                            <div class="col-sm-9 mail_view">
                                                <div class="inbox-body">
                                                    <div class="mail_heading row">
                                                        <div class="col-md-8">
                                                            <div class="compose-btn">
                                                                <a class="btn btn-sm btn-primary" href="mail_compose.html"><i class="fa fa-reply"></i> Reply</a>
                                                                <button title="" data-placement="top" data-toggle="tooltip" type="button" data-original-title="Print" class="btn  btn-sm tooltips"><i class="fa fa-print"></i> </button>
                                                                <button title="" data-placement="top" data-toggle="tooltip" data-original-title="Trash" class="btn btn-sm tooltips">
                                                                    <i class="fa fa-trash-o"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 text-right">
                                                            <p class="date" id="emailDate"> </p>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <h4 id="emailtitle"></h4>
                                                        </div>
                                                    </div>
                                                    <div class="sender-info">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <span id="customerEmail"></span> to
                                                                <strong>me</strong>
                                                                <a class="sender-dropdown"><i class="fa fa-chevron-down"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="view-mail">
                                                        <p id="MailContent"></p>
                                                        
                                                    </div>


                                                </div>
                                            </div>
                                            <!-- /CONTENT MAIL -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>






                </div>
            </div>
            <p style="text-align: center;font-size:30px"><strong>In the Past</strong></p>
            <div style="margin-top:20px" class="tab" role="tabpanel">
                <!-- Nav tabs -->
                <ul style="list-style:none;" class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#Section1" aria-controls="home" role="tab" data-toggle="tab"><i class="fa fa-envelope-o"></i>All</a></li>
                    <li role="presentation"><a href="#Section2" aria-controls="profile" role="tab" data-toggle="tab"><i class="fa fa-cube"></i>Memo</a></li>
                    <li role="presentation"><a href="#Section3" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-comment"></i>Email</a></li>
                    <li role="presentation"><a href="#Section4" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-comment"></i>Phone Call</a></li>
                    <li role="presentation"><a href="#Section5" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-comment"></i>Meetings</a></li>
                    <li role="presentation"><a href="#Section6" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-comment"></i>Document</a></li>

                    <li role="presentation"><a href="#Section7" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-comment"></i>Incomplete/Late</a></li>

                    <li role="presentation"><a href="#Section8" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-comment"></i>Completed</a></li>

                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade in active" id="Section1">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description.Trim()).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }


                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                    <a href="#" class="float" data-toggle="modal" data-target="#myNewTaskModal">
                        <i class="fa fa-plus my-float"></i>
                    </a>
                    <div role="tabpanel" class="tab-pane fade" id="Section2">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && task.type == 1)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }
                            </section> <!-- cd-timeline -->
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="Section3">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && task.type == 2)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }

                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="Section4">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && task.type == 3)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }

                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="Section5">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && task.type == 4)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }

                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="Section6">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && task.type == 5)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }

                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="Section7">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && task.status == 4)
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }

                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="Section8">
                        <div class="pre-scrollable" id="timelinecontainer" style="height:800px;max-height: 800px; ">

                            <section id="cd-timeline" class="cd-container">
                                @foreach (DealTask task in thisDeal.DealTasks.ToList().OrderByDescending(x => x.Deadline))
                                {
                                    if (task.Deadline < DateTime.Today && (task.status == 5 || task.status == 2))
                                    {
                                        <div class="cd-timeline-block">
                                            <div class="cd-timeline-img cd-location">
                                                <img src="~/Content/@(task.TaskType.Description).png" alt="Picture" />

                                            </div> <!-- cd-timeline-img -->
                                            <div class="cd-timeline-content">
                                                <h2 style="font-size:25px">@task.TaskName</h2>
                                                <p style="font-size:15px">@task.TaskDescription</p>
                                                <a href="#0" class="cd-read-more">Finish It!</a>
                                                <span class="cd-date">@task.Deadline</span>
                                            </div> <!-- cd-timeline-content -->
                                        </div> <!-- cd-timeline-block -->
                                    }
                                }

                            </section> <!-- cd-timeline -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="myNewTaskModal" role="dialog">
                <div class="modal-dialog">

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form style="width:100%" action="CreateNewTask" method="post" class="basic-grey">

                                <p style="text-align: center;font-size:30px"><strong>New Task</strong></p>
                                <label style="width:100%">
                                    <span style="width:20%">Task Title :</span>
                                    <input type="hidden" value="@thisDeal.id" name="dealID" />
                                    <input style="width:70%;max-width:70%" id="title" type="text" name="title" />
                                </label>

                                <label style="width:100%">
                                    <span style="width:20%">Description :</span>
                                    <textarea style="width:70%;max-width:70%" id="message" name="description"></textarea>
                                </label>
                                <label style="width:100%">
                                    <span>Type</span><select name="type">
                                        @foreach (TaskType type in (List<TaskType>)ViewData["TaskTypes"])
                                        {
                                            if (type.id != 7 && type.id != 8)
                                            {
                                                <option value="@type.id">@type.typeName</option>
                                            }

                                        }


                                    </select>
                                </label>
                                <label style="width:100%">
                                    <span style="width:20%">DeadLine :</span>
                                    <input style="width:70%" type="text" name="deadline" id="datepicker">
                                </label>
                                <label>
                                    <span>&nbsp;</span>
                                    <input type="submit" class="button" value="Make" />
                                </label>
                            </form>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="col-sm-9">

            </div>
        </div>
    </div>
        <script>
            function editMail(id) {
                var newcontent = document.getElementById(id + "mailcontent_ifr").contentWindow.document.body.innerHTML;
                $.post("/Deal/EditPlanMail", { taskid: id, newcontent: newcontent })
                .done(function (data) {
                    $.each(data, function (key, value) {
                        if (key == "result") {
                            if (value == "success") {
                                alert("Success");
                            }
                            else {
                                alert("Oops, something wrong happened");
                            }
                        }
                    })
                });

            }
        </script>
        <div class="modal fade bs-example-modal-lg" id="ItemModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">×</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">Deal's items</h4>
                    </div>
                    <div class="modal-body">
                        <div class="x_panel">

                            <div class="x_content">

                                <!-- start accordion -->
                                <div class="accordion" id="accordion" role="tablist" aria-multiselectable="true">
                                    <div class="panel">
                                        <a class="panel-heading collapsed" role="tab" id="headingOne" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                            <h4 class="panel-title">Items list</h4>
                                        </a>
                                        <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" aria-expanded="false" style="height: 0px;">
                                            <div class="panel-body">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Plan Name</th>
                                                            <th>Proposed Price</th>
                                                            <th>Quantity</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (Deal_Item item in thisDeal.Deal_Item)
                                                        {
                                                            <tr>
                                                                <td>
                                                                    @item.productMarketPlan.Name
                                                                </td>
                                                                <td>
                                                                    @item.price
                                                                </td>
                                                                <td>
                                                                    @item.Quantity
                                                                </td>
                                                                <td>
                                                                    <a href="#" class="btn btn-info btn-xs"><i class="fa fa-pencil"></i> Edit </a>
                                                                    <a href="#" class="btn btn-danger btn-xs"><i class="fa fa-trash-o"></i> Delete </a>
                                                                </td>
                                                            </tr>
                                                        }
                                                        <tr>
                                                            <form action="/Deal/AddItemToDeal" method="post">
                                                                <td>
                                                                    @Html.DropDownList("planID", (List<SelectListItem>)ViewData["PlanList"], htmlAttributes: new { @class = "form-control", @id = "selectplan" })
                                                                </td>
                                                                <td>
                                                                    <input type="number" id="valuebound" value="" name="suggestprice" min="1" max="100000" />
                                                                </td>

                                                                <td>
                                                                    <input type="number" value="" name="quantity" min="1" max="100000" />
                                                                </td>

                                                                <td>
                                                                    <button type="submit" class="btn btn-success">Submit</button>
                                                                </td>
                                                                <input type="hidden" value="@thisDeal.id" name="dealID" />
                                                            </form>
                                                            <script>
                                                                $('#selectplan').on('change', function () {
                                                                    $.getJSON("/Deal/getPlanMinMax?planID=" + $('#selectplan').val(), function (result) {
                                                                        $.each(result, function (name, value) {
                                                                            if (name == "min") { $("#valuebound").prop("min",value); }

                                                                            if (name == "max") { $("#valuebound").prop("max", value); }

                                                                        });

                                                                    });
                                                                });
                                                            </script>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="panel">
                                        <a class="panel-heading collapsed" role="tab" id="headingTwo" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                            <h4 class="panel-title">Commission Rate</h4>
                                        </a>
                                        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo" aria-expanded="false" style="height: 0px;">
                                            <div class="panel-body">
                                                <p>
                                                    <strong>Collapsible Item 2 data</strong>
                                                </p>
                                                Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor,
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- end of accordion -->


                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>

                </div>
            </div>
        </div>
}
